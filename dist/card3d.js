!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Card3d=t()}(this,(function(){"use strict";const e=[],t={delta:10,perspective:500,startX:0,startY:0,glareOpacity:.5,axis:"all",scale:1};class i{constructor(i,n){this.card3dElement=i,this.config=n,this.gyroOrigin=null,e.push({element:i,instance:this}),this.config||(this.config=this.setConfigFromAttributes()),this.config=Object.assign({},t,this.config),this.config.stop?this.stop():this.start()}updateConfig(e){this.config=null!=e?e:this.setConfigFromAttributes(),this.config.stop?this.stop():(this.stop(),this.start())}setConfigFromAttributes(){var e,i,o,r,a,l;const d=this.card3dElement.dataset,c=n(d.card3dFullPageListening),h=n(d.card3dNoReset),u=n(d.card3dGlare),g=n(d.card3dReverse),m=n(d.card3dStop),f=n(d.card3dGyroscopie),p=null!==(e=s(d.card3dDelta))&&void 0!==e?e:t.delta,v=null!==(i=s(d.card3dPerspective))&&void 0!==i?i:t.perspective,y=null!==(o=s(d.card3dStartX))&&void 0!==o?o:t.startX,E=null!==(r=s(d.card3dStartY))&&void 0!==r?r:t.startY,b=null!==(a=s(d.card3dGlare))&&void 0!==a?a:t.glareOpacity,w=null!==(l=s(d.card3dScale))&&void 0!==l?l:t.scale;let x="all";return"x"===d.card3dAxis?x="x":"y"===d.card3dAxis&&(x="y"),{gyroscopie:f,stop:m,scale:w,delta:p,axis:x,noReset:h,reverse:g,fullPageListening:c,perspective:v,startX:y,startY:E,glare:u,glareOpacity:b}}removeEventListener(){this.focusElement.removeEventListener("mousemove",this.eventMouseMoove),this.focusElement.removeEventListener("mouseout",this.eventMouseOut),this.config.gyroscopie&&window.removeEventListener("deviceorientation",this.eventDeviceOrientation)}setupEventListener(){this.eventMouseMoove=e=>this.mousemove(e),this.eventMouseOut=()=>this.mouseout(),this.focusElement.addEventListener("mousemove",this.eventMouseMoove),this.config.noReset||this.focusElement.addEventListener("mouseout",this.eventMouseOut),this.config.gyroscopie&&(this.eventDeviceOrientation=e=>this.gyro(e),window.addEventListener("deviceorientation",this.eventDeviceOrientation))}gyro(e){const t=e.beta,i=e.gamma;"number"==typeof i&&"number"==typeof t&&this.mousemove({clientY:t/45,clientX:i/45,gyroscopie:!0})}stop(){const t=o(this.card3dElement);e.splice(t,1),this.card3dElement.setAttribute("data-card3d-stop","true"),this.reset()}reset(){this.card3dElement.style.transform="",this.card3dElement.style.transition="",this.glareElement&&this.glareElement.remove(),this.removeEventListener()}applyGlare(){this.glareElement=document.createElement("span"),this.glareElement.setAttribute("style","\n        will-change: transform;\n        position: absolute;\n        background-image: linear-gradient(0deg, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);\n        pointer-event: none; \n        transform-origin: 0% 0%;\n        transform: translate(-50%, -50%) rotate(180deg);\n        opacity: 0;\n        z-index: 999;\n        "),this.card3dElement.appendChild(this.glareElement)}start(){this.focusElement=this.config.fullPageListening?document.body:this.card3dElement,this.setupEventListener(),this.config.glare&&this.applyGlare(),this.card3dElement.style.overflow="hidden",this.card3dElement.style.willChange="transform",this.card3dElement.style.transform=`\n        perspective(500px) \n        rotateX(${this.config.startY}deg) \n        rotateY(${this.config.startX}deg)\n        `}mousemove(e){if(!this.card3dElement.isConnected||!this.focusElement.isConnected)return void this.stop();this.card3dElement.style.transition="";const t=this.config,i=t.reverse?1:-1,n=this.card3dElement.getBoundingClientRect(),s=n.width/2,o=n.height/2,r=n.left+s,a=n.top+o,l=-1*(r-e.clientX),d=a-e.clientY,c=this.focusElement!==this.card3dElement?window.innerWidth/2:n.width/2,h=this.focusElement!==this.card3dElement?window.innerHeight/2:n.height/2;let u=0,g=0;if("gyroscopie"in e?(this.gyroOrigin||(this.gyroOrigin={x:e.clientX,y:e.clientY}),u=(this.gyroOrigin.x-e.clientX)*t.delta,g=(this.gyroOrigin.y-e.clientY)*t.delta):("y"!==t.axis&&(u=l/c*t.delta),"x"!==t.axis&&(g=d/h*t.delta)),t.glare){const i=Math.atan2(e.clientX-r,-(e.clientY-a))*(180/Math.PI),s=2*(n.width>n.height?n.width:n.height);this.glareElement.style.opacity=t.glareOpacity.toString(),this.glareElement.style.left="50%",this.glareElement.style.top="50%",this.glareElement.style.width=s+"px",this.glareElement.style.height=s+"px",this.glareElement.style.transform=`rotate(${i}deg) translate(-50%, -50%)`,this.glareElement.style.display="block"}this.card3dElement.style.transform=`\n        perspective(${t.perspective}px) \n        rotateX(${g*i}deg) \n        rotateY(${u*i}deg)\n        scale(${t.scale})\n        `}mouseout(){this.card3dElement.style.transition="0.5s ease",this.card3dElement.style.transform="",this.glareElement&&(this.glareElement.style.opacity="0")}}function n(e){return null!=e&&(""===e||"true"===e)}function s(e){const t=parseFloat(e);return isNaN(t)||"number"!=typeof t?void 0:t}function o(t){return e.findIndex((e=>e.element===t))}function r(e){var t,s;for(const r of e){const e=-1!==o(r),a=void 0===(null===(t=r.dataset)||void 0===t?void 0:t.card3d),l=n(null===(s=r.dataset)||void 0===s?void 0:s.card3dStop);e||l||a||new i(r)}}return document.addEventListener("DOMContentLoaded",(function(){r(document.querySelectorAll("[data-card3d]")),new MutationObserver((function(t){var i;const s=[];for(const r of null!=t?t:[]){if("attributes"===r.type&&r.attributeName.includes("data-card3d")){const t=r.target,a=o(t),l=-1!==a;n(null===(i=t.dataset)||void 0===i?void 0:i.card3d)&&-1===a?s.push(t):l&&e[a].instance.updateConfig()}for(const e of r.addedNodes)s.push(e);for(const t of r.removedNodes){const i=o(t);-1!==i&&e.splice(i,1)}}s.length>0&&r(s)})).observe(window.document.documentElement,{childList:!0,subtree:!0,attributes:!0})})),i}));
//# sourceMappingURL=card3d.js.map
